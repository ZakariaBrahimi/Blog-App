{% extends 'base.html' %}
{% block content%}
   <div class="flex my-12">
    <main id="box" class="h-5/6 w-8/12 m-auto flex flex-col gap-6 " >
        {% for post in posts %}
        <Article class="bg-white p-6 flex flex-col gap-4 shadow-lg rounded-lg post" id='postBox'>
            <img src="{{post.img.url}}"  alt="">
            <h1 class="text-gray-900 text-xl">{{post.title}}</h1>
            <P class="text-gray-600">
                {{post.content|truncatewords:50}}
            </P>
            <div class="text-gray-500 flex justify-between items-center">
                <a href="{% url 'blog:singl_post' post.slug post.id %}">
                    <button class="border-2 p-2 px-5 rounded border-gray-500 hover:bg-gray-500 hover:text-white  transition duration-500 ease-in-out">Continue Reading</button>
                </a>
                <div class="">
                    <span class="border-r-2 px-4">{{post.published_at|date:"D, d M, Y"}}</span>
                    

                    <form id="{{post.id}}" action="" method='POST' class='likeForm'>
                        {% csrf_token %}
                        <input type="hidden" name="{{post.id}}" value="{{post.id}}">
                        <span class="border-r-2 px-4" >
                            <button type="submit">
                                <svg id="likeBtn" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                                </svg>
                            </button>
                            {{post.like_set.all|length}}
                        </span>
                    </form>
                    


                    <span class=" px-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd" />
                        </svg>
                        {{post.comment_set.all|length}}
                    </span>
                </div>
            </div>
        </Article>
        {% endfor %}

        <div class='flex justify-center'>
            <form method='GET' action=''>
                {% csrf_token %}
                <button class="bg-blue-500 p-2 px-4 rounded-lg shadow-lg flex text-white font-bold" type="submit" id='loadMoreBtn'>More Posts</button>
            </form>
            
        </div>

        <!-- <div class="flex w-full justify-center text-blue-600 mt-5 ">
            <span class="bg-white p-2 px-3 border rounded-tl-lg rounded-bl-lg">Previous</span>
            <span class="bg-white p-2 px-4 border">2</span>
            <span class="bg-white p-2 px-4 border bg-blue-600 text-white">3</span>
            <span class="bg-white p-2 px-4 border">4</span>
            <span class="bg-white p-2 px-5 border rounded-tr-lg rounded-br-lg">Next</span>
        </div> -->
    </main>
    {% if  user.is_authenticated %}
    <aside class=" flex flex-col items-center p-6 bg-white h-full w-3/12 rounded-lg mr-6 shadow-lg ">
        <a href=" {% url 'blog:create_post' %} ">
            <form method="GET">
            <button id="createPostBtn" class="bg-blue-500 p-2 px-24 shadow-2xl rounded-lg text-white hover:shadow-4xl font-bold" type="submit">New Post</button>
            </form>
        </a>
    </aside>
    {% endif%}
</div>
{%endblock%}
{%block bottom_js%}

<script>
// const convertToMonth = (month)=>{
//   switch (month){
//     case "01":
//       return 'Jan';
//       break;
//     case "02":
//       return 'Feb';
//       break;
//     case "09":
//       return 'Sept';
//       break;
//   }
// }

// const displayDate = (date)=>{
//   // Sept. 23, 2021, 6:40 a.m.
//   // date = fields['date'] ===>> 2021-09-23T06:41:38.018Z
//   let dateArray = date.split("-"); // [ "2021", "09", "23T06:41:38.018Z" ]
//   let year = dateArray[0];
//   let month = convertToMonth(dateArray[1]);
//   let day = dateArray[2].slice(0,2);
//   // let time = displayTime(dateArray[2]);
//   let result = `${month}. ${day}, ${year}`;
//   return result
// }




// const searchInput = document.getElementById('search');
// const box = document.getElementById('box');
// const data = '{{jsonPosts}}'
// const rdata = JSON.parse(data.replace(/&quot;/g, '"'))
// let filteredArr = []
// // console.log(rdata)
// searchInput.addEventListener('keyup', (e)=>{
//     box.innerHTML = ""
//     filteredArr = rdata.filter(info=> info['fields']['title'].includes(e.target.value))
//     console.log(filteredArr)    
//     if(filteredArr.length > 0){
//         filteredArr.map(item=>{
//             let date = displayDate(item['fields']['published_at'])
//             // console.log(item['fields']['img'])
//             box.innerHTML = `
//                 <Article class="bg-white p-6 flex flex-col gap-4 shadow-lg rounded-lg post" id='postBox'>
//             <img src='/media/${item['fields']['img']}'  alt="">
//             <h1 class="text-gray-900 text-xl">${item['fields']['title']}</h1>
//             <P class="text-gray-600">
//                 ${item['fields']['content']}
//             </P>
//             <div class="text-gray-500 flex justify-between items-center">
//                 <a href="/singl-post/${item['fields']['slug']}/${item['pk']}">
//                     <button class="border-2 p-2 px-5 rounded border-gray-500 hover:bg-gray-500 hover:text-white  transition duration-500 ease-in-out">Continue Reading</button>
//                 </a>
//                 <div class="">
//                     <span class="border-r-2 px-4">${date}</span>
                    

//                     <form id="${item['pk']}" action="" method='POST' class='likeForm'>
//                         {% csrf_token %}
//                         <input type="hidden" name="${item['pk']}" value="${item['pk']}">
//                         <span class="border-r-2 px-4" >
//                             <button type="submit">
//                                 <svg id="likeBtn" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block" viewBox="0 0 20 20" fill="currentColor">
//                                     <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
//                                 </svg>
//                             </button>
//                             {{post.like_set.all|length}}

//                         </span>
//                     </form>
                    


//                     <span class=" px-4">
//                         <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block" viewBox="0 0 20 20" fill="currentColor">
//                         <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd" />
//                         </svg>
//                         {{post.comment_set.all|length}}
//                     </span>
//                 </div>
//             </div>
//         </Article>
//         `
//         })
//     }else{
//         box.innerHTML = `<b>there are no posts ...</b>`
//     }
// })


const postBox = document.querySelector('#postBox');
const loadMoreBtn = document.querySelector('#loadMoreBtn');
visible = 8
const handlgetData = ()=> {
    let csrfValue = document.getElementsByName("csrfmiddlewaretoken")[0].value;
    fetch("/posts/"+ visible,
  {
    method: 'GET',
    headers: {
        "X-CSRFToken": csrfValue,
        "X-Requested-With": "XMLHttpRequest", //Necessary to work with request.is_ajax()
    },
  }
    ).then(function(response) {
      return response.json(); //Convert response to JSON Data
    }).then(function(response){
      const data = response.data
      data.map(post => {
        console.log(post)
    })
      // console.log(data)
    })
}
handlgetData();
loadMoreBtn.addEventListener('submit', (e)=>{
    e.preventDefault()
    // visible += 3;
    console.log('submited')
    handlgetData();
});
// console.log(5555)
// console.log(visible)
</script>
{%endblock%}